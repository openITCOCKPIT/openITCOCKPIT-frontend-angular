<ng-container *transloco="let t">
    <nav aria-label="breadcrumb" class="mt-3">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a [routerLink]="['/']">
                    <fa-icon [icon]="['fas', 'home']"></fa-icon>
                    {{ t('Home') }}
                </a></li>
            <li class="breadcrumb-item">
                <a *oitcPermission="['packages', 'linux']" [routerLink]="['/', 'packages', 'linux']">
                    <fa-icon [icon]="['fas', 'cubes']"></fa-icon>
                    {{ t('Packages') }}
                </a>
            </li>
            <li aria-current="page" class="breadcrumb-item active">
                <fa-icon [icon]="['fas', 'list']"></fa-icon>
                {{ t('Overview') }}
            </li>
        </ol>
    </nav>
    @if (!summary) {
        <oitc-block-loader [height]="'25rem'"></oitc-block-loader>
    }
    @if (summary) {
        <c-card class="mb-3">
            <c-card-header>
                <h5 cCardTitle>
                    {{ t('Packages') }}
                </h5>
            </c-card-header>
            <c-card-body>
                <c-row class="equal-height-row d-flex flex-wrap">
                    <c-col [xs]="12" [md]="6" [lg]="3" [xl]="2" [offset]="{xl: 2, lg: 0, md:0, xs:0}">
                        <c-widget-stat-f
                            [title]="String(summary.total | localNumber)"
                            [value]="'Packages' | transloco"
                            class="mb-3"
                            padding>
                            <ng-template cTemplateId="widgetIconTemplate">
                                <fa-icon [icon]="['fas', 'cubes']" [cTextColor]="'primary'" [size]="'2xl'"></fa-icon>
                            </ng-template>
                            <ng-template cTemplateId="widgetFooterTemplate">
                                <c-row>
                                    <c-col class="text-center px-0">
                                        <fa-icon [icon]="['fab', 'linux']" [cTextColor]="'primary'"></fa-icon>
                                        {{ summary.linux.totalPackages }}
                                    </c-col>
                                    <c-col class="text-center px-0">
                                        <fa-icon [icon]="['fab', 'windows']" [cTextColor]="'primary'"></fa-icon>
                                        {{ summary.windows.totalPackages }}
                                    </c-col>
                                    <c-col class="text-center px-0">
                                        <fa-icon [icon]="['fab', 'apple']" [cTextColor]="'primary'"></fa-icon>
                                        {{ summary.macos.totalPackages }}
                                    </c-col>
                                </c-row>
                            </ng-template>
                        </c-widget-stat-f>
                    </c-col>
                    <c-col [xs]="12" [md]="6" [lg]="3" [xl]="2">
                        <c-widget-stat-f
                            [value]="'Outdated Packages' | transloco"
                            [title]="String(summary.outdated | localNumber)"
                            class="mb-3"
                            padding>
                            <ng-template cTemplateId="widgetIconTemplate">
                                <fa-icon [icon]="['fas', 'triangle-exclamation']" [cTextColor]="'warning'"
                                         [size]="'2xl'"></fa-icon>
                            </ng-template>
                            <ng-template cTemplateId="widgetFooterTemplate">
                                <c-row>
                                    <c-col class="text-center px-0">
                                        <fa-icon [icon]="['fab', 'linux']" [cTextColor]="'primary'"></fa-icon>
                                        {{ summary.linux.updatesAvailable }}
                                    </c-col>
                                    <c-col class="text-center px-0">
                                        <fa-icon [icon]="['fab', 'windows']" [cTextColor]="'primary'"></fa-icon>
                                        {{ summary.windows.updatesAvailable }}
                                    </c-col>
                                    <c-col class="text-center px-0">
                                        <fa-icon [icon]="['fab', 'apple']" [cTextColor]="'primary'"></fa-icon>
                                        {{ summary.macos.updatesAvailable }}
                                    </c-col>
                                </c-row>
                            </ng-template>
                        </c-widget-stat-f>
                    </c-col>
                    <c-col [xs]="12" [md]="6" [lg]="3" [xl]="2">
                        <c-widget-stat-f
                            [value]="'Security Packages' | transloco"
                            [title]="String(summary.security | localNumber)"
                            class="mb-3"
                            padding>
                            <ng-template cTemplateId="widgetIconTemplate" class="me-0">
                                <fa-icon [icon]="['fas', 'shield']" [cTextColor]="'danger'" [size]="'2xl'"></fa-icon>
                            </ng-template>
                            <ng-template cTemplateId="widgetFooterTemplate">
                                <c-row>
                                    <c-col class="text-center px-0">
                                        <fa-icon [icon]="['fab', 'linux']" [cTextColor]="'primary'"></fa-icon>
                                        {{ summary.linux.securityUpdates }}
                                    </c-col>
                                    <c-col class="text-center px-0">
                                        <fa-icon [icon]="['fab', 'windows']" [cTextColor]="'primary'"></fa-icon>
                                        {{ summary.windows.securityUpdates }}
                                    </c-col>
                                    <c-col class="text-center px-0">
                                        <fa-icon [icon]="['fab', 'apple']" [cTextColor]="'primary'"></fa-icon>
                                        {{ summary.macos.securityUpdates }}
                                    </c-col>
                                </c-row>
                            </ng-template>
                        </c-widget-stat-f>
                    </c-col>
                    <c-col [xs]="12" [md]="6" [lg]="3" [xl]="2">
                        <c-widget-stat-f
                            [value]="'Outdated Hosts' | transloco"
                            [title]="String(summary.outdated_hosts | localNumber)"
                            class="mb-3"
                            padding>
                            <ng-template cTemplateId="widgetIconTemplate">
                                <fa-icon [icon]="['fas', 'server']" [cTextColor]="'warning'" [size]="'2xl'"></fa-icon>
                            </ng-template>
                            <ng-template cTemplateId="widgetFooterTemplate">
                                <c-row>
                                    <c-col class="text-center px-0">
                                        <fa-icon [icon]="['fab', 'linux']" [cTextColor]="'primary'"></fa-icon>
                                        {{ summary.linux.hostsWithUpdates.length }}
                                    </c-col>
                                    <c-col class="text-center px-0">
                                        <fa-icon [icon]="['fab', 'windows']" [cTextColor]="'primary'"></fa-icon>
                                        {{ summary.windows.hostsWithUpdates.length }}
                                    </c-col>
                                    <c-col class="text-center px-0">
                                        <fa-icon [icon]="['fab', 'apple']" [cTextColor]="'primary'"></fa-icon>
                                        {{ summary.macos.hostsWithUpdates.length }}
                                    </c-col>
                                </c-row>
                            </ng-template>
                        </c-widget-stat-f>
                    </c-col>
                    <c-col [xs]="12" [md]="6" [lg]="3" [xl]="2">
                        <c-widget-stat-f
                            [value]="'Outdated Hosts' | transloco"
                            [title]="String(summary.security_hosts | localNumber)"
                            class="mb-3"
                            padding>
                            <ng-template cTemplateId="widgetIconTemplate">
                                <fa-icon [icon]="['fas', 'server']" [cTextColor]="'danger'" [size]="'2xl'"></fa-icon>
                            </ng-template>
                            <ng-template cTemplateId="widgetFooterTemplate">
                                <c-row>
                                    <c-col class="text-center px-0">
                                        <fa-icon [icon]="['fab', 'linux']" [cTextColor]="'primary'"></fa-icon>
                                        {{ summary.linux.hostsWithSecurityUpdates.length }}
                                    </c-col>
                                    <c-col class="text-center px-0">
                                        <fa-icon [icon]="['fab', 'windows']" [cTextColor]="'primary'"></fa-icon>
                                        {{ summary.windows.hostsWithSecurityUpdates.length }}
                                    </c-col>
                                    <c-col class="text-center px-0">
                                        <fa-icon [icon]="['fab', 'apple']" [cTextColor]="'primary'"></fa-icon>
                                        {{ summary.macos.hostsWithSecurityUpdates.length }}
                                    </c-col>
                                </c-row>
                            </ng-template>
                        </c-widget-stat-f>
                    </c-col>
                </c-row>
                <c-tabs [activeItemKey]="'linux'">
                    <c-tabs-list variant="underline-border" class="justify-content-end mt-1">
                        <button cTab [itemKey]="'linux'">
                            <fa-icon [icon]="['fab', 'linux']" [cTextColor]="'primary'"></fa-icon>
                            {{ t('Linux') }}
                        </button>
                        <button cTab [itemKey]="'windows'">
                            <fa-icon [icon]="['fab', 'windows']" [cTextColor]="'primary'"></fa-icon>
                            {{ t('Windows') }}
                        </button>
                        <button cTab [itemKey]="'macos'">
                            <fa-icon [icon]="['fab', 'apple']" [cTextColor]="'primary'"></fa-icon>
                            {{ t('macOS') }}
                        </button>
                    </c-tabs-list>
                    <c-tabs-content>
                        <c-tab-panel class="p-3" [itemKey]="'linux'">
                            <c-row>
                                <c-col>
                                    <table cTable [striped]="true">
                                        <thead>
                                        <tr>
                                            <th class="width-15 text-center"></th>
                                            <th scope="col" mat-sort-header="PackagesLinux.name">
                                                {{ t('Package') }}
                                            </th>
                                            <th>{{ t('Installed on') }}</th>
                                            <th>{{ t('Status') }}</th>
                                        </thead>
                                        <tbody>

                                            @for (package of packages?.all_packages_linux; track $index) {
                                                <tr>
                                                    <td class="text-center">
                                                        <fa-icon [icon]="['fas', 'cube']"
                                                                 [cTextColor]="packageLinuxStatus[package.cumulated_status]"></fa-icon>
                                                    </td>
                                                    <td>{{ package.name }}</td>
                                                    <td>{{ package.package_linux_hosts.length }}</td>
                                                    <td>
                                                        <oitc-badge-outline color="warning" class="me-1">
                                                            3
                                                        </oitc-badge-outline>
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </c-col>
                            </c-row>
                            @if (packages && packages.all_packages_linux.length === 0) {
                                <oitc-no-records></oitc-no-records>
                            }
                            @if (packages) {
                                <c-container
                                    [fluid]="true">
                                    <c-row>
                                        <c-col>
                                            @if (packages) {
                                                <oitc-paginate-or-scroll
                                                    (paginatorChange)="onPaginatorChange($event)"
                                                    [paginateOrScroll]="packages"></oitc-paginate-or-scroll>
                                            }
                                        </c-col>
                                    </c-row>
                                </c-container>
                            }
                        </c-tab-panel>
                        <c-tab-panel class="p-3" [itemKey]="'windows'">
                            WINDOWS
                        </c-tab-panel>
                        <c-tab-panel class="p-3" [itemKey]="'macos'">
                            MAC
                        </c-tab-panel>

                    </c-tabs-content>
                </c-tabs>

            </c-card-body>
        </c-card>
    }
</ng-container>
