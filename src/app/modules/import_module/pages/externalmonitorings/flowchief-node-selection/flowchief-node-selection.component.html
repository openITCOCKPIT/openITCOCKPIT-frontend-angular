<ng-container *transloco="let t">
    <nav aria-label="breadcrumb" class="mt-3">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a [routerLink]="['/']">
                    <fa-icon [icon]="['fas', 'home']"></fa-icon>
                    {{ t('Home') }}
                </a>
            </li>
            <li class="breadcrumb-item">
                <fa-icon [icon]="['fas', 'puzzle-piece']"></fa-icon>
                {{ t('Import Module') }}
            </li>
            <li class="breadcrumb-item">
                <a *oitcPermission="['importmodule','ExternalSystems', 'index']"
                   [routerLink]="['/', 'import_module', 'ExternalSystems', 'index']">
                    <fa-icon [icon]="['fas', 'external-link-alt']"></fa-icon>
                    {{ t('External Systems') }}
                </a>
            </li>
            <li aria-current="page" class="breadcrumb-item active">
                <fa-icon [icon]="['fas', 'folder-tree']"></fa-icon>
                {{ t('Select FlowChief nodes') }}
            </li>
        </ol>
    </nav>

    <oitc-form-loader [isVisible]="!post"></oitc-form-loader>

    @if (post) {
        <form cForm (ngSubmit)="submit()">
            <c-card class="mb-3">
                <c-card-header>
                    <h5 cCardTitle>{{ t('Select FlowChief Nodes') }}</h5>
                    <c-nav class="card-toolbar card-header-pills">
                        <c-nav-item class="px-1">
                            <button [fallbackUrl]="['import_module', 'ExternalSystems', 'index']" cButton class="ripple"
                                    color="default"
                                    oitcBackButton
                                    size="xs">
                                <fa-icon [icon]="['fas', 'left-long']"></fa-icon>
                                {{ t('Back') }}
                            </button>
                        </c-nav-item>
                    </c-nav>
                </c-card-header>
                <c-card-body>

                    <div class="mb-3">
                        <label cLabel for="FlowChiefNodesSelect">
                            {{ t('FlowChief Nodes (Plantexplorer)') }}
                        </label>
                        <oitc-multi-select
                            name="FlowChiefNodesSelect"
                            id="FlowChiefNodesSelect"
                            optionValue="key"
                            optionLabel="value"
                            [options]="flowchiefNodes"
                            [(ngModel)]="selectedNodes"
                            [debounce]="true"
                            [disableCheckThatEnsuresSelectedValueExistsInOptions]="true"
                            [searchCallback]="loadFlowchiefNodes"
                            (ngModelChange)="updateNodesMembership()">
                        </oitc-multi-select>
                        <div class="help-block small">
                            {{ t('openITCOCKPIT will import all Process Variables from the selected nodes.') }}
                            <br>
                            {{ t('In case the list is empty, execute the command') }}
                            <code>oitc import_module.flowchief_import_nodes
                                --external-monitoring-system-id {{ post.id }}</code>
                            {{ t('on the openITCOCKPIT server to get the list of available nodes.') }}
                        </div>
                        <oitc-form-feedback [errors]="errors"
                                            errorField="flowchief_nodes_membership"></oitc-form-feedback>
                    </div>

                    <div class="mb-3">

                        @for (nodeMembership of post.flowchief_nodes_membership; track $index) {
                            <div>

                                {{ nodeMembership.path }}
                                <c-form-check>
                                    <input
                                        cFormCheckInput
                                        class="checkbox-lg checkbox-primary"
                                        [id]="'is_recursive'+$index"
                                        [name]="'is_recursive'+$index"
                                        type="checkbox"
                                        [(ngModel)]="nodeMembership._joinData.is_recursive"/>

                                    <label cFormCheckLabel
                                           [for]="'is_recursive'+$index"
                                           class="ms-1 mt-1">
                                        {{ t('Load PVs recursive') }}
                                    </label>
                                </c-form-check>

                            </div>
                        }

                    </div>

                </c-card-body>

                <c-card-footer class="text-end">
                    <button cButton class="ripple" color="primary" type="submit">
                        {{ t('Save') }}
                    </button>
                    <button [fallbackUrl]="['import_module','ExternalSystems', 'index']" cButton class="ms-1 ripple"
                            color="default" oitcBackButton type="button">
                        {{ t('Cancel') }}
                    </button>
                </c-card-footer>
            </c-card>
        </form>
    }
</ng-container>

